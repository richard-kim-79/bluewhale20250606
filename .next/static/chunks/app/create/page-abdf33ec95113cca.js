(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[572],{8574:function(e,t,a){Promise.resolve().then(a.bind(a,8520))},8520:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return m}});var n=a(7437),s=a(2265),o=a(9501),l=a(3590),r=a(1115),i=a(9376),c=a(4362),d=a(8223);let u=r.z.object({title:r.z.string().min(1,"제목을 입력해주세요").max(100,"제목은 100자 이내로 입력해주세요"),contentType:r.z.enum(["text","pdf"]),textContent:r.z.string().max(5e3,"텍스트는 최대 ".concat(5e3,"자까지 입력 가능합니다")).optional(),allowLocation:r.z.boolean().default(!0)});function m(){let e=(0,i.useRouter)(),{user:t,isAuthenticated:a,loading:r}=(0,c.a)(),[m,x]=(0,s.useState)(!1),[p,h]=(0,s.useState)(""),[g,f]=(0,s.useState)(null),[y,w]=(0,s.useState)(null),b=(0,s.useRef)(null),{register:v,handleSubmit:j,watch:N,formState:{errors:C}}=(0,o.cI)({resolver:(0,l.F)(u),defaultValues:{contentType:"text",allowLocation:!0}}),k=N("contentType"),T=N("allowLocation"),S=()=>{navigator.geolocation&&T&&navigator.geolocation.getCurrentPosition(e=>{w({lat:e.coords.latitude,lng:e.coords.longitude})},e=>{console.error("Error getting location:",e),h("위치 정보를 가져오는데 실패했습니다. 위치 권한을 확인해주세요.")})};(0,s.useEffect)(()=>{T&&S()},[T]);let F=async t=>{if(!a){e.push("/login");return}if("pdf"===t.contentType&&!g){h("PDF 파일을 선택해주세요.");return}if("text"===t.contentType&&(!t.textContent||""===t.textContent.trim())){h("텍스트 내용을 입력해주세요.");return}x(!0),h("");try{let a=new FormData;a.append("title",t.title),a.append("contentType",t.contentType),"text"===t.contentType&&t.textContent?a.append("textContent",t.textContent):"pdf"===t.contentType&&g&&a.append("file",g),T&&y&&(a.append("latitude",y.lat.toString()),a.append("longitude",y.lng.toString()));let n=await d.gT.createContent(a);n&&n.data&&n.data.id?e.push("/content/".concat(n.data.id)):e.push("/profile")}catch(e){var n,s;h((null===(s=e.response)||void 0===s?void 0:null===(n=s.data)||void 0===n?void 0:n.message)||"콘텐츠 업로드에 실패했습니다.")}finally{x(!1)}};return((0,s.useState)(()=>{T&&S()}),r)?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-whale-600"})}):a||r?(0,n.jsx)("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,n.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-8",children:"새 콘텐츠 작성"}),p&&(0,n.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:p}),(0,n.jsxs)("form",{className:"space-y-6",onSubmit:j(F),children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"제목"}),(0,n.jsxs)("div",{className:"mt-1",children:[(0,n.jsx)("input",{id:"title",type:"text",className:"input-field",...v("title")}),C.title&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:C.title.message})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"콘텐츠 유형"}),(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{id:"contentType-text",type:"radio",value:"text",className:"h-4 w-4 text-blue-whale-600 focus:ring-blue-whale-500",...v("contentType")}),(0,n.jsx)("label",{htmlFor:"contentType-text",className:"ml-2 block text-sm text-gray-700",children:"텍스트"})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{id:"contentType-pdf",type:"radio",value:"pdf",className:"h-4 w-4 text-blue-whale-600 focus:ring-blue-whale-500",...v("contentType")}),(0,n.jsx)("label",{htmlFor:"contentType-pdf",className:"ml-2 block text-sm text-gray-700",children:"PDF 파일"})]})]})]}),"text"===k&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{htmlFor:"textContent",className:"block text-sm font-medium text-gray-700",children:"텍스트 내용 (최대 5,000자)"}),(0,n.jsxs)("div",{className:"mt-1",children:[(0,n.jsx)("textarea",{id:"textContent",rows:10,className:"input-field",...v("textContent")}),C.textContent&&(0,n.jsx)("p",{className:"mt-1 text-sm text-red-600",children:C.textContent.message})]})]}),"pdf"===k&&(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"PDF 파일 (최대 10MB)"}),(0,n.jsx)("div",{className:"mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md",children:(0,n.jsxs)("div",{className:"space-y-1 text-center",children:[(0,n.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true",children:(0,n.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),(0,n.jsxs)("div",{className:"flex text-sm text-gray-600",children:[(0,n.jsxs)("label",{htmlFor:"file-upload",className:"relative cursor-pointer bg-white rounded-md font-medium text-blue-whale-600 hover:text-blue-whale-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-whale-500",children:[(0,n.jsx)("span",{children:"파일 선택"}),(0,n.jsx)("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",accept:"application/pdf",ref:b,onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){if(a.size>10485760){h("파일 크기는 10MB 이하여야 합니다. 현재 파일 크기: ".concat((a.size/1048576).toFixed(2),"MB"));return}if("application/pdf"!==a.type){h("PDF 파일만 업로드 가능합니다.");return}f(a),h("")}}})]}),(0,n.jsx)("p",{className:"pl-1",children:"또는 여기에 파일을 끌어다 놓으세요"})]}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"PDF 파일만 가능합니다"})]})}),g&&(0,n.jsxs)("p",{className:"mt-2 text-sm text-green-600",children:["선택된 파일: ",g.name," (",(g.size/1048576).toFixed(2),"MB)"]})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("input",{id:"allowLocation",type:"checkbox",className:"h-4 w-4 text-blue-whale-600 focus:ring-blue-whale-500 border-gray-300 rounded",...v("allowLocation")}),(0,n.jsx)("label",{htmlFor:"allowLocation",className:"ml-2 block text-sm text-gray-700",children:"내 현재 위치 정보 포함하기"})]}),T&&y&&(0,n.jsx)("div",{className:"bg-blue-50 border border-blue-200 text-blue-700 px-4 py-3 rounded",children:(0,n.jsxs)("p",{className:"text-sm",children:["위치 정보가 성공적으로 확인되었습니다. 위도: ",y.lat.toFixed(6),", 경도: ",y.lng.toFixed(6)]})}),(0,n.jsxs)("div",{className:"flex justify-end",children:[(0,n.jsx)("button",{type:"button",className:"mr-4 btn-secondary",onClick:()=>e.back(),children:"취소"}),(0,n.jsx)("button",{type:"submit",disabled:m,className:"btn-primary",children:m?(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"업로드 중..."]}):"게시하기"})]})]})]})}):(e.push("/login"),null)}},4362:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return i},a:function(){return r}});var n=a(7437),s=a(2265),o=a(8223);let l=(0,s.createContext)(void 0),r=()=>{let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e},i=e=>{let{children:t}=e,[a,r]=(0,s.useState)(null),[i,c]=(0,s.useState)(!0),[d,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{let e=localStorage.getItem("user");if(localStorage.getItem("authToken")&&e)try{{let e=await o.kv.getCurrentUser();r(e),u(!0)}}catch(e){console.error("Error fetching current user:",e),localStorage.removeItem("authToken"),localStorage.removeItem("user")}c(!1)})()},[]);let m=async(e,t)=>{try{let{user:a,token:n}=await o.kv.login(e,t);localStorage.setItem("authToken",n),localStorage.setItem("user",JSON.stringify(a)),r(a),u(!0)}catch(e){throw console.error("Login failed:",e),e}},x=async(e,t)=>{try{let{user:a,token:n}=await o.kv.register(e,t);localStorage.setItem("authToken",n),localStorage.setItem("user",JSON.stringify(a)),r(a),u(!0)}catch(e){throw console.error("Registration failed:",e),e}},p=async()=>{try{await o.kv.logout()}catch(e){console.error("Logout API call failed:",e)}finally{localStorage.removeItem("authToken"),localStorage.removeItem("user"),r(null),u(!1)}};return(0,n.jsx)(l.Provider,{value:{user:a,isAuthenticated:d,loading:i,login:m,register:x,logout:p},children:t})}},8223:function(e,t,a){"use strict";a.d(t,{Lz:function(){return l},TV:function(){return r},gT:function(){return o},kv:function(){return s}});let n=a(3464).Z.create({baseURL:"http://bluewhale-backend-env.eba-wehmnn34.ap-northeast-2.elasticbeanstalk.com",headers:{"Content-Type":"application/json"}});n.interceptors.request.use(e=>{let t=localStorage.getItem("authToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,e=>(e.response&&401===e.response.status&&(localStorage.removeItem("authToken"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e)));let s={login:async(e,t)=>(await n.post("/auth/login",{email:e,password:t})).data,register:async(e,t)=>(await n.post("/auth/register",{email:e,password:t})).data,getCurrentUser:async()=>(await n.get("/auth/me")).data,logout:async()=>(await n.post("/auth/logout")).data},o={getContent:async e=>(await n.get("/content",{params:e})).data,getGlobalTopContent:async e=>(await n.get("/content/global-top",{params:e})).data,getPersonalizedContent:async e=>(await n.get("/content/personalized",{params:e})).data,getLocalContent:async e=>(await n.get("/content/local",{params:e})).data,getContentById:async e=>(await n.get("/content/".concat(e))).data,createContent:async e=>(await n.post("/content",e,{headers:{"Content-Type":"multipart/form-data"}})).data,updateContent:async(e,t)=>(await n.put("/content/".concat(e),t,{headers:{"Content-Type":"multipart/form-data"}})).data,deleteContent:async e=>(await n.delete("/content/".concat(e))).data,searchContent:async(e,t)=>(await n.get("/content/search",{params:{query:e,...t}})).data,getUserContent:async(e,t)=>(await n.get(e?"/content/user/".concat(e):"/content/my-content",{params:t})).data,saveContent:async e=>(await n.post("/content/".concat(e,"/save"))).data,unsaveContent:async e=>(await n.delete("/content/".concat(e,"/save"))).data,getSavedContent:async e=>(await n.get("/content/saved",{params:e})).data},l={getNotifications:async e=>(await n.get("/notifications",{params:e})).data,markAsRead:async e=>(await n.put("/notifications/".concat(e,"/read"))).data,markAllAsRead:async()=>(await n.put("/notifications/read-all")).data,getUnreadCount:async()=>(await n.get("/notifications/unread-count")).data},r={getUserProfile:async e=>(await n.get("/users/".concat(e))).data,updateUserProfile:async e=>{let t=new FormData;return e.name&&t.append("name",e.name),e.bio&&t.append("bio",e.bio),e.avatar&&t.append("avatar",e.avatar),(await n.put("/users/profile",t,{headers:{"Content-Type":"multipart/form-data"}})).data},followUser:async e=>(await n.post("/users/".concat(e,"/follow"))).data,unfollowUser:async e=>(await n.delete("/users/".concat(e,"/follow"))).data,getUserFollowers:async(e,t)=>(await n.get("/users/".concat(e,"/followers"),{params:t})).data,getUserFollowing:async(e,t)=>(await n.get("/users/".concat(e,"/following"),{params:t})).data,searchUsers:async(e,t)=>(await n.get("/users/search",{params:{query:e,...t}})).data}}},function(e){e.O(0,[301,558,971,117,744],function(){return e(e.s=8574)}),_N_E=e.O()}]);