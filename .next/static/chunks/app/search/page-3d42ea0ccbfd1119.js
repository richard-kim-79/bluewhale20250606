(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[797],{8019:function(e,t,a){Promise.resolve().then(a.bind(a,6314))},6314:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var s=a(7437),l=a(2265),r=a(9376),n=a(8223),i=a(9295),o=a(3145),c=a(7648),d=a(6681),m=a(4362);function x(){let e=(0,r.useRouter)(),{isAuthenticated:t}=(0,m.a)(),[a,x]=(0,l.useState)(""),[u,h]=(0,l.useState)([]),[g,b]=(0,l.useState)([]),[f,p]=(0,l.useState)(!1),[y,w]=(0,l.useState)([]),[j,v]=(0,l.useState)("content"),[N,k]=(0,l.useState)("relevance"),[S,C]=(0,l.useState)("all"),[E,T]=(0,l.useState)(null),[A,F]=(0,l.useState)(null),[U,L]=(0,l.useState)(5),[V,_]=(0,l.useState)(1),[D,P]=(0,l.useState)(1),[O,B]=(0,l.useState)(10);(0,l.useEffect)(()=>{let e=localStorage.getItem("recentSearches");e&&w(JSON.parse(e)),navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{T({lat:e.coords.latitude,lng:e.coords.longitude})},e=>{console.error("위치 정보를 가져오는데 실패했습니다:",e)})},[]);let I=async e=>{if(e.preventDefault(),a.trim()){p(!0),_(1);try{var t,s;let e=[a,...y.filter(e=>e!==a)].slice(0,5);if(w(e),localStorage.setItem("recentSearches",JSON.stringify(e)),"content"===j){let e={};"nearby"===S&&E?e={location:{lat:E.lat,lng:E.lng,radius:U}}:"custom"===S&&A&&(e={location:{lat:A.lat,lng:A.lng,radius:A.radius}});let s=await n.gT.searchContent(a,{page:V,limit:O,sort:N,...e});h((null==s?void 0:s.data)||[]),P((null==s?void 0:null===(t=s.pagination)||void 0===t?void 0:t.totalPages)||1),b([])}else{let e=await n.TV.searchUsers(a,{page:V,limit:O});b((null==e?void 0:e.data)||[]),P((null==e?void 0:null===(s=e.pagination)||void 0===s?void 0:s.totalPages)||1),h([])}p(!1)}catch(e){console.error("Error searching ".concat(j,":"),e),"content"===j?h([]):b([]),p(!1)}}},M=t=>{e.push("/content/".concat(t))},W=async e=>{try{await n.TV.followUser(e),b(t=>t.map(t=>t.id===e?{...t,isFollowing:!0}:t))}catch(e){console.error("Error following user:",e),alert("사용자 팔로우 중 오류가 발생했습니다.")}},Z=async e=>{try{await n.TV.unfollowUser(e),b(t=>t.map(t=>t.id===e?{...t,isFollowing:!1}:t))}catch(e){console.error("Error unfollowing user:",e),alert("사용자 언팔로우 중 오류가 발생했습니다.")}},z=async e=>{if(!(e<1)&&!(e>D)&&e!==V){p(!0),_(e);try{if("content"===j){let t={};"nearby"===S&&E?t={location:{lat:E.lat,lng:E.lng,radius:U}}:"custom"===S&&A&&(t={location:{lat:A.lat,lng:A.lng,radius:A.radius}});let s=await n.gT.searchContent(a,{page:e,limit:O,sort:N,...t});h((null==s?void 0:s.data)||[])}else{let t=await n.TV.searchUsers(a,{page:e,limit:O});b((null==t?void 0:t.data)||[])}}catch(e){console.error("Error changing page:",e)}finally{p(!1)}}},J=e=>{k(e);let t={preventDefault:()=>{}};setTimeout(()=>I(t),0)};return(0,s.jsxs)("main",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(i.Z,{}),(0,s.jsx)("div",{className:"max-w-6xl mx-auto px-4 py-6",children:(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6",children:[(0,s.jsxs)("div",{className:"lg:w-3/4",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"검색"}),(0,s.jsx)("div",{className:"mb-6 border-b border-gray-200",children:(0,s.jsxs)("div",{className:"flex space-x-4 mb-6",children:[(0,s.jsx)("button",{onClick:()=>v("content"),className:"px-4 py-2 text-sm font-medium rounded-md ".concat("content"===j?"bg-blue-whale-600 text-white":"bg-white text-gray-700 border border-gray-300"),children:"콘텐츠"}),(0,s.jsx)("button",{onClick:()=>v("users"),className:"px-4 py-2 text-sm font-medium rounded-md ".concat("users"===j?"bg-blue-whale-600 text-white":"bg-white text-gray-700 border border-gray-300"),children:"사용자"})]})}),(0,s.jsx)("form",{onSubmit:I,className:"mb-6",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("input",{type:"text",value:a,onChange:e=>x(e.target.value),placeholder:"키워드, 주제, 위치 등을 검색하세요",className:"flex-grow px-4 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-whale-500"}),(0,s.jsx)("button",{type:"submit",className:"bg-blue-whale-600 text-white px-4 py-2 rounded-r-md hover:bg-blue-whale-700 focus:outline-none focus:ring-2 focus:ring-blue-whale-500",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"w-5 h-5",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})})})]})}),"content"===j&&a.trim()&&u.length>0&&(0,s.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm mb-4",children:(0,s.jsx)("div",{className:"flex flex-wrap gap-4 items-center",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700 mr-2",children:"정렬:"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>J("relevance"),className:"px-3 py-1 text-xs font-medium rounded-full ".concat("relevance"===N?"bg-blue-whale-600 text-white":"bg-gray-100 text-gray-700"),children:"관련성"}),(0,s.jsx)("button",{onClick:()=>J("date"),className:"px-3 py-1 text-xs font-medium rounded-full ".concat("date"===N?"bg-blue-whale-600 text-white":"bg-gray-100 text-gray-700"),children:"최신순"}),(0,s.jsx)("button",{onClick:()=>J("aiScore"),className:"px-3 py-1 text-xs font-medium rounded-full ".concat("aiScore"===N?"bg-blue-whale-600 text-white":"bg-gray-100 text-gray-700"),children:"AI 점수"})]})]})})}),(0,s.jsx)("div",{children:f?(0,s.jsx)("div",{className:"flex justify-center py-12",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-whale-600"})}):"content"===j&&(null==u?void 0:u.length)>0?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-2",children:"콘텐츠 검색 결과"}),u.map(e=>(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-shadow p-4 cursor-pointer",onClick:()=>M(e.id),children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 hover:text-blue-whale-600",children:e.title}),(0,s.jsxs)("div",{className:"flex items-center mt-1 text-sm text-gray-500",children:[(0,s.jsx)("span",{children:e.author.email}),(0,s.jsx)("span",{className:"mx-2",children:"•"}),(0,s.jsx)("span",{children:new Date(e.createdAt).toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"})})]}),(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-600 line-clamp-2",children:e.summary})]}),(0,s.jsxs)("div",{className:"flex flex-col items-end",children:[(0,s.jsx)("div",{className:"".concat("pdf"===e.type?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"," px-2 py-1 rounded-full text-xs font-medium"),children:"pdf"===e.type?"PDF":"TEXT"}),(0,s.jsxs)("div",{className:"mt-2 flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4 mr-1 text-blue-600",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6l4 2"})}),(0,s.jsx)("span",{className:"text-xs text-blue-600",children:e.aiScore})]})]})]}),e.hasLocation&&e.location&&(0,s.jsxs)("div",{className:"mt-2 text-xs text-gray-500",children:["위치: ",e.location.name||"".concat(e.location.lat,", ").concat(e.location.lng)]})]},e.id)),D>1&&(0,s.jsx)("div",{className:"flex justify-center mt-8",children:(0,s.jsxs)("nav",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>z(V-1),disabled:1===V,className:"px-3 py-1 rounded-md ".concat(1===V?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:"이전"}),[...Array(D)].map((e,t)=>{let a=t+1;return 1===a||a===D||a>=V-2&&a<=V+2?(0,s.jsx)("button",{onClick:()=>z(a),className:"px-3 py-1 rounded-md ".concat(a===V?"bg-blue-whale-600 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:a},t):a===V-3&&V>3||a===V+3&&V<D-2?(0,s.jsx)("span",{className:"px-2",children:"..."},t):null}),(0,s.jsx)("button",{onClick:()=>z(V+1),disabled:V===D,className:"px-3 py-1 rounded-md ".concat(V===D?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:"다음"})]})})]}):"users"===j&&(null==g?void 0:g.length)>0?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-2",children:"사용자 검색 결과"}),g.map(e=>(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 flex justify-between items-center",children:[(0,s.jsxs)(c.default,{href:"/user/".concat(e.id),className:"flex items-center flex-grow",children:[(0,s.jsx)("div",{className:"relative w-12 h-12 rounded-full overflow-hidden bg-gray-200 mr-4",children:e.avatar?(0,s.jsx)(o.default,{src:e.avatar,alt:e.name||e.email,fill:!0,className:"object-cover"}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:(e.name||e.email).charAt(0).toUpperCase()})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium",children:e.name||e.email}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:e.email}),e.bio&&(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:e.bio})]})]}),(0,s.jsx)("div",{children:e.isFollowing?(0,s.jsx)("button",{onClick:()=>Z(e.id),className:"ml-4 px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-whale-500",children:"팔로잉"}):(0,s.jsx)("button",{onClick:()=>W(e.id),className:"ml-4 px-4 py-2 bg-blue-whale-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-blue-whale-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-whale-500",children:"팔로우"})})]},e.id)),D>1&&(0,s.jsx)("div",{className:"flex justify-center mt-8",children:(0,s.jsxs)("nav",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>z(V-1),disabled:1===V,className:"px-3 py-1 rounded-md ".concat(1===V?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:"이전"}),[...Array(D)].map((e,t)=>{let a=t+1;return 1===a||a===D||a>=V-2&&a<=V+2?(0,s.jsx)("button",{onClick:()=>z(a),className:"px-3 py-1 rounded-md ".concat(a===V?"bg-blue-whale-600 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:a},t):a===V-3&&V>3||a===V+3&&V<D-2?(0,s.jsx)("span",{className:"px-2",children:"..."},t):null}),(0,s.jsx)("button",{onClick:()=>z(V+1),disabled:V===D,className:"px-3 py-1 rounded-md ".concat(V===D?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:"다음"})]})})]}):(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-6 text-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-12 h-12 mx-auto text-gray-400 mb-4",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"검색어를 입력하세요"}),(0,s.jsx)("p",{className:"text-gray-600",children:"content"===j?"키워드, 주제, 위치 등으로 콘텐츠를 검색할 수 있습니다.":"이메일, 이름 등으로 사용자를 검색할 수 있습니다."})]})})]}),(0,s.jsx)("div",{className:"lg:w-1/4",children:t&&"users"===j&&(0,s.jsx)(d.Z,{limit:5,title:"팔로우 추천"})})]})})]})}},6681:function(e,t,a){"use strict";var s=a(7437),l=a(2265),r=a(8223),n=a(3145),i=a(7648),o=a(4362);t.Z=e=>{let{limit:t=3,title:a="팔로우 추천",excludeUserId:c}=e,{isAuthenticated:d,user:m}=(0,o.a)(),[x,u]=(0,l.useState)([]),[h,g]=(0,l.useState)(!0),[b,f]=(0,l.useState)(""),[p,y]=(0,l.useState)({});(0,l.useEffect)(()=>{d&&(async()=>{try{g(!0);let e=(await r.TV.searchUsers("",{limit:t+5})).data||[];(null==m?void 0:m.id)&&(e=e.filter(e=>e.id!==m.id)),c&&(e=e.filter(e=>e.id!==c)),e=e.slice(0,t),u(e),g(!1)}catch(e){console.error("Error fetching recommended users:",e),f("추천 사용자를 불러오는데 실패했습니다."),g(!1)}})()},[d,null==m?void 0:m.id,t,c]);let w=async e=>{if(!p[e]){y(t=>({...t,[e]:!0}));try{let t=x.find(t=>t.id===e);if(!t)return;t.isFollowing?(await r.TV.unfollowUser(e),u(t=>t.map(t=>t.id===e?{...t,isFollowing:!1}:t))):(await r.TV.followUser(e),u(t=>t.map(t=>t.id===e?{...t,isFollowing:!0}:t)))}catch(e){console.error("Error toggling follow status:",e)}finally{y(t=>({...t,[e]:!1}))}}};return d?h?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[(0,s.jsx)("h2",{className:"text-lg font-medium mb-4",children:a}),(0,s.jsx)("div",{className:"animate-pulse space-y-3",children:[...Array(t)].map((e,t)=>(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("div",{className:"rounded-full bg-gray-200 h-10 w-10"}),(0,s.jsxs)("div",{className:"flex-1 space-y-2 py-1",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]})]},t))})]}):b?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[(0,s.jsx)("h2",{className:"text-lg font-medium mb-4",children:a}),(0,s.jsx)("p",{className:"text-red-500 text-sm",children:b})]}):0===x.length?null:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:[(0,s.jsx)("h2",{className:"text-lg font-medium mb-4",children:a}),(0,s.jsxs)("div",{className:"space-y-4",children:[x.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(i.default,{href:"/user/".concat(e.id),className:"flex items-center flex-grow",children:[(0,s.jsx)("div",{className:"relative w-10 h-10 rounded-full overflow-hidden bg-gray-200 mr-3",children:e.avatar?(0,s.jsx)(n.default,{src:e.avatar,alt:e.name||e.email,fill:!0,className:"object-cover"}):(0,s.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-500",children:(e.name||e.email).charAt(0).toUpperCase()})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-sm",children:e.name||e.email}),e.bio?(0,s.jsx)("p",{className:"text-xs text-gray-500 truncate max-w-[150px]",children:e.bio}):(0,s.jsx)("p",{className:"text-xs text-gray-500 truncate max-w-[150px]",children:e.email})]})]}),(0,s.jsx)("button",{onClick:()=>w(e.id),disabled:p[e.id],className:"ml-2 px-3 py-1 text-xs font-medium rounded-full ".concat(e.isFollowing?"text-gray-700 bg-gray-100 hover:bg-gray-200":"text-white bg-blue-whale-600 hover:bg-blue-whale-700"," focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-whale-500"),children:p[e.id]?(0,s.jsx)("span",{className:"inline-block w-4 h-4 border-2 border-t-transparent border-white rounded-full animate-spin"}):e.isFollowing?"팔로잉":"팔로우"})]},e.id)),(0,s.jsx)("div",{className:"pt-2 text-center",children:(0,s.jsx)(i.default,{href:"/search?tab=users",className:"text-sm text-blue-whale-600 hover:text-blue-whale-800",children:"더 많은 사용자 찾기"})})]})]}):null}}},function(e){e.O(0,[301,648,145,295,971,117,744],function(){return e(e.s=8019)}),_N_E=e.O()}]);